<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyword Builder - GeekSuite Pro</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap');
        
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
            --accent-gradient: linear-gradient(135deg, #06b6d4 0%, #3b82f6 50%, #8b5cf6 100%);
            --success-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-hover: rgba(255, 255, 255, 0.25);
            --shadow-light: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            --shadow-heavy: 0 25px 50px rgba(0,0,0,0.15);
            --shadow-glow: 0 0 40px rgba(99, 102, 241, 0.3);
            --border-radius: 24px;
            --border-radius-sm: 16px;
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-light: rgba(255, 255, 255, 0.9);
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .main-container {
            background: var(--glass-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-heavy), var(--shadow-glow);
            backdrop-filter: blur(25px);
            border: 2px solid var(--glass-border);
            margin: 2rem auto;
            max-width: 1400px;
            position: relative;
            animation: slideInUp 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .main-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s ease;
        }

        .main-container:hover::before {
            left: 100%;
        }

        .main-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.05) 50%, transparent 70%);
            pointer-events: none;
        }

        .header {
            background: var(--secondary-gradient);
            color: white;
            padding: 80px 50px;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(255,255,255,0.1) 0%, transparent 50%);
            animation: float 8s ease-in-out infinite;
        }

        .header h1 {
            font-size: 4rem;
            font-weight: 900;
            letter-spacing: -0.03em;
            position: relative;
            z-index: 2;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #ffffff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: fadeInDown 1.2s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.4rem;
            opacity: 0.95;
            font-weight: 500;
            position: relative;
            z-index: 2;
            animation: fadeInUp 1.2s cubic-bezier(0.4, 0, 0.2, 1) 0.4s both;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
            margin-top: 10px;
            font-weight: 400;
            animation: fadeInUp 1.2s cubic-bezier(0.4, 0, 0.2, 1) 0.6s both;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            50% {
                transform: translate(-50%, -50%) rotate(180deg);
            }
        }
        .keyword-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--border-radius-sm);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: var(--transition);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.6);
            position: relative;
            overflow: hidden;
        }

        .keyword-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-gradient);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .keyword-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.8);
            background: var(--glass-hover);
        }

        .keyword-card:hover::before {
            transform: scaleX(1);
        }
        .keyword-badge {
            font-size: 0.8rem;
            padding: 0.4rem 0.8rem;
            border-radius: 25px;
            margin-right: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .keyword-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .difficulty-low { background-color: #dcfce7; color: #166534; }
        .difficulty-medium { background-color: #fef3c7; color: #92400e; }
        .difficulty-high { background-color: #fee2e2; color: #991b1b; }
        .category-primary { background-color: #dbeafe; color: #1e40af; }
        .category-secondary { background-color: #f3e8ff; color: #7c2d12; }
        .category-long-tail { background-color: #ecfdf5; color: #065f46; }
        .category-branded { background-color: #fef7ff; color: #86198f; }
        .category-competitor { background-color: #fff1f2; color: #be123c; }
        .btn-gradient {
            background: var(--secondary-gradient);
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 1.1rem;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }

        .btn-gradient:hover::before {
            left: 100%;
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-secondary {
            background: var(--secondary-gradient);
            border: none;
            color: white;
            transition: var(--transition);
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 600;
            font-family: inherit;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }

        .btn-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn-gradient:hover::before {
            left: 100%;
        }

        .btn-gradient:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
            color: white;
        }

        .stats-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem 1.5rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--secondary-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .stats-card:hover::before {
            transform: scaleX(1);
        }

        .search-box {
            border-radius: 20px;
            border: 2px solid rgba(229, 231, 235, 0.8);
            padding: 1rem 1.5rem;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            font-family: inherit;
        }

        .search-box:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1), 0 8px 25px rgba(79, 70, 229, 0.15);
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.95);
            outline: none;
        }

        .search-box::placeholder {
            color: #9ca3af;
            transition: var(--transition);
        }

        .search-box:focus::placeholder {
            opacity: 0.7;
            transform: translateY(-2px);
        }
        .loading {
            display: none;
        }
        .alert {
            border-radius: 12px;
            border: none;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: var(--glass-bg); backdrop-filter: blur(20px); border-bottom: 1px solid var(--glass-border); box-shadow: var(--shadow-light);">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/" style="font-size: 1.5rem; background: var(--secondary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">GeekSuite Pro</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" style="border: none; box-shadow: none;">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/ad-grader" style="border-radius: 25px; padding: 8px 20px; margin: 0 5px; transition: var(--transition);">Ad Grader</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/keyword-builder" style="background: rgba(255,255,255,0.2); border-radius: 25px; padding: 8px 20px; margin: 0 5px; transition: var(--transition);">Keyword Builder</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <style>
        .nav-link:hover {
            background: rgba(255,255,255,0.2) !important;
            transform: translateY(-2px);
        }
        
        .navbar-brand:hover {
            transform: scale(1.05);
            transition: var(--transition);
        }
    </style>

    <div class="container-fluid">
        <div class="main-container">
            <!-- Header -->
            <div class="header">
                <h1><i class="fas fa-key me-3"></i>Keyword Builder</h1>
                <p class="subtitle">Research • Organize • Optimize</p>
                <p class="mb-0">Manage your marketing and SEO keywords for better campaign targeting</p>
            </div>

            <div class="p-4">
                <!-- Alert Messages -->
                <div id="alertContainer"></div>

                <!-- Stats Row -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stats-card">
                            <h3 id="totalKeywords" class="text-primary mb-1">0</h3>
                            <small class="text-muted">Total Keywords</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <h3 id="activeKeywords" class="text-success mb-1">0</h3>
                            <small class="text-muted">Active Keywords</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <h3 id="avgSearchVolume" class="text-info mb-1">0</h3>
                            <small class="text-muted">Avg Search Volume</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <h3 id="avgCpc" class="text-warning mb-1">$0.00</h3>
                            <small class="text-muted">Avg CPC</small>
                        </div>
                    </div>
                </div>

                <!-- Controls Row -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="input-group">
                            <input type="text" id="searchInput" class="form-control search-box" placeholder="Search keywords...">
                            <button class="btn btn-gradient" type="button" onclick="searchKeywords()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <select id="categoryFilter" class="form-select" onchange="filterKeywords()">
                            <option value="">All Categories</option>
                            <option value="primary">Primary</option>
                            <option value="secondary">Secondary</option>
                            <option value="long-tail">Long-tail</option>
                            <option value="branded">Branded</option>
                            <option value="competitor">Competitor</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-gradient w-100" onclick="showAddKeywordModal()">
                            <i class="fas fa-plus me-2"></i>Add Keywords
                        </button>
                    </div>
                </div>

                <!-- Keywords List -->
                <div id="keywordsList" class="row">
                    <!-- Keywords will be loaded here -->
                </div>

                <!-- Loading Spinner -->
                <div id="loadingSpinner" class="text-center loading">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>

                <!-- Pagination -->
                <nav id="pagination" class="mt-4">
                    <ul class="pagination justify-content-center">
                        <!-- Pagination will be generated here -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- Add Keyword Modal -->
    <div class="modal fade" id="addKeywordModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Keywords</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Single Keyword</h6>
                            <form id="singleKeywordForm">
                                <div class="mb-3">
                                    <label class="form-label">Keyword</label>
                                    <input type="text" id="singleKeyword" class="form-control" required>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label class="form-label">Category</label>
                                        <select id="singleCategory" class="form-select">
                                            <option value="primary">Primary</option>
                                            <option value="secondary">Secondary</option>
                                            <option value="long-tail">Long-tail</option>
                                            <option value="branded">Branded</option>
                                            <option value="competitor">Competitor</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Difficulty</label>
                                        <select id="singleDifficulty" class="form-select">
                                            <option value="low">Low</option>
                                            <option value="medium">Medium</option>
                                            <option value="high">High</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Search Volume</label>
                                        <input type="number" id="singleSearchVolume" class="form-control" min="0">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">CPC ($)</label>
                                        <input type="number" id="singleCpc" class="form-control" min="0" step="0.01">
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <label class="form-label">Intent</label>
                                    <select id="singleIntent" class="form-select">
                                        <option value="informational">Informational</option>
                                        <option value="navigational">Navigational</option>
                                        <option value="transactional">Transactional</option>
                                        <option value="commercial">Commercial</option>
                                    </select>
                                </div>
                                <div class="mt-3">
                                    <label class="form-label">Notes</label>
                                    <textarea id="singleNotes" class="form-control" rows="2"></textarea>
                                </div>
                                <button type="submit" class="btn btn-gradient mt-3">Add Keyword</button>
                            </form>
                        </div>
                        <div class="col-md-6">
                            <h6>Bulk Import</h6>
                            <form id="bulkKeywordForm">
                                <div class="mb-3">
                                    <label class="form-label">Keywords (one per line)</label>
                                    <textarea id="bulkKeywords" class="form-control" rows="8" placeholder="keyword 1&#10;keyword 2&#10;keyword 3"></textarea>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label class="form-label">Default Category</label>
                                        <select id="bulkCategory" class="form-select">
                                            <option value="primary">Primary</option>
                                            <option value="secondary">Secondary</option>
                                            <option value="long-tail">Long-tail</option>
                                            <option value="branded">Branded</option>
                                            <option value="competitor">Competitor</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Default Difficulty</label>
                                        <select id="bulkDifficulty" class="form-select">
                                            <option value="low">Low</option>
                                            <option value="medium">Medium</option>
                                            <option value="high">High</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <label class="form-label">Default Intent</label>
                                    <select id="bulkIntent" class="form-select">
                                        <option value="informational">Informational</option>
                                        <option value="navigational">Navigational</option>
                                        <option value="transactional">Transactional</option>
                                        <option value="commercial">Commercial</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-gradient mt-3">Import Keywords</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Keyword Modal -->
    <div class="modal fade" id="editKeywordModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Keyword</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editKeywordForm">
                        <input type="hidden" id="editKeywordId">
                        <div class="mb-3">
                            <label class="form-label">Keyword</label>
                            <input type="text" id="editKeyword" class="form-control" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Category</label>
                                <select id="editCategory" class="form-select">
                                    <option value="primary">Primary</option>
                                    <option value="secondary">Secondary</option>
                                    <option value="long-tail">Long-tail</option>
                                    <option value="branded">Branded</option>
                                    <option value="competitor">Competitor</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Difficulty</label>
                                <select id="editDifficulty" class="form-select">
                                    <option value="low">Low</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <label class="form-label">Search Volume</label>
                                <input type="number" id="editSearchVolume" class="form-control" min="0">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">CPC ($)</label>
                                <input type="number" id="editCpc" class="form-control" min="0" step="0.01">
                            </div>
                        </div>
                        <div class="mt-3">
                            <label class="form-label">Intent</label>
                            <select id="editIntent" class="form-select">
                                <option value="informational">Informational</option>
                                <option value="navigational">Navigational</option>
                                <option value="transactional">Transactional</option>
                                <option value="commercial">Commercial</option>
                            </select>
                        </div>
                        <div class="mt-3">
                            <label class="form-label">Notes</label>
                            <textarea id="editNotes" class="form-control" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-gradient" onclick="updateKeyword()">Update Keyword</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentPage = 1;
        let currentSearch = '';
        let currentCategory = '';
        let keywords = [];
        let stats = {};

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadKeywords();
            loadStats();
            
            // Setup form handlers
            document.getElementById('singleKeywordForm').addEventListener('submit', addSingleKeyword);
            document.getElementById('bulkKeywordForm').addEventListener('submit', addBulkKeywords);
            document.getElementById('editKeywordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateKeyword();
            });
            
            // Setup search on enter
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchKeywords();
                }
            });
        });

        // Load keywords from API
        async function loadKeywords(page = 1, search = '', category = '') {
            showLoading(true);
            try {
                const params = new URLSearchParams({
                    page: page,
                    limit: 12,
                    sort: 'keyword'
                });
                
                if (search) params.append('search', search);
                if (category) params.append('category', category);
                
                const response = await fetch(`/api/keywords?${params}`);
                const data = await response.json();
                
                if (data.success) {
                    keywords = data.data;
                    displayKeywords(keywords);
                    displayPagination(data.pagination);
                } else {
                    showAlert('Error loading keywords: ' + data.message, 'danger');
                }
            } catch (error) {
                showAlert('Error loading keywords: ' + error.message, 'danger');
            }
            showLoading(false);
        }

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch('/api/keywords/stats');
                const data = await response.json();
                
                if (data.success) {
                    stats = data.data;
                    updateStatsDisplay();
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('totalKeywords').textContent = stats.total || 0;
            document.getElementById('activeKeywords').textContent = stats.active || 0;
            
            // Calculate average search volume from breakdown
            let totalVolume = 0;
            let totalCpc = 0;
            let count = 0;
            
            if (stats.breakdown) {
                stats.breakdown.forEach(item => {
                    if (item.avgSearchVolume) {
                        totalVolume += parseFloat(item.avgSearchVolume) * parseInt(item.count);
                        count += parseInt(item.count);
                    }
                    if (item.avgCpc) {
                        totalCpc += parseFloat(item.avgCpc) * parseInt(item.count);
                    }
                });
            }
            
            const avgVolume = count > 0 ? Math.round(totalVolume / count) : 0;
            const avgCpc = count > 0 ? (totalCpc / count).toFixed(2) : '0.00';
            
            document.getElementById('avgSearchVolume').textContent = avgVolume.toLocaleString();
            document.getElementById('avgCpc').textContent = '$' + avgCpc;
        }

        // Display keywords
        function displayKeywords(keywordList) {
            const container = document.getElementById('keywordsList');
            
            if (keywordList.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No keywords found</h5>
                        <p class="text-muted">Try adjusting your search or add some keywords to get started.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = keywordList.map(keyword => `
                <div class="col-md-6 col-lg-4">
                    <div class="keyword-card">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="mb-0">${keyword.keyword}</h6>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="editKeyword('${keyword.id}')"><i class="fas fa-edit me-2"></i>Edit</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="toggleKeyword('${keyword.id}')"><i class="fas fa-toggle-${keyword.isActive ? 'on' : 'off'} me-2"></i>${keyword.isActive ? 'Deactivate' : 'Activate'}</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item text-danger" href="#" onclick="deleteKeyword('${keyword.id}')"><i class="fas fa-trash me-2"></i>Delete</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="mb-2">
                            <span class="keyword-badge category-${keyword.category}">${keyword.category}</span>
                            <span class="keyword-badge difficulty-${keyword.difficulty}">${keyword.difficulty}</span>
                            ${!keyword.isActive ? '<span class="keyword-badge bg-secondary text-white">Inactive</span>' : ''}
                        </div>
                        <div class="row text-center">
                            <div class="col-4">
                                <small class="text-muted d-block">Volume</small>
                                <strong>${(keyword.searchVolume || 0).toLocaleString()}</strong>
                            </div>
                            <div class="col-4">
                                <small class="text-muted d-block">CPC</small>
                                <strong>$${(keyword.cpc || 0).toFixed(2)}</strong>
                            </div>
                            <div class="col-4">
                                <small class="text-muted d-block">Intent</small>
                                <strong class="text-capitalize">${keyword.intent}</strong>
                            </div>
                        </div>
                        ${keyword.notes ? `<div class="mt-2"><small class="text-muted">${keyword.notes}</small></div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Display pagination
        function displayPagination(pagination) {
            const container = document.getElementById('pagination').querySelector('ul');
            
            if (pagination.pages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // Previous button
            html += `<li class="page-item ${pagination.page === 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="changePage(${pagination.page - 1})">&laquo;</a>
            </li>`;
            
            // Page numbers
            for (let i = 1; i <= pagination.pages; i++) {
                if (i === pagination.page || i === 1 || i === pagination.pages || (i >= pagination.page - 1 && i <= pagination.page + 1)) {
                    html += `<li class="page-item ${i === pagination.page ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                    </li>`;
                } else if (i === pagination.page - 2 || i === pagination.page + 2) {
                    html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
            }
            
            // Next button
            html += `<li class="page-item ${pagination.page === pagination.pages ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="changePage(${pagination.page + 1})">&raquo;</a>
            </li>`;
            
            container.innerHTML = html;
        }

        // Change page
        function changePage(page) {
            currentPage = page;
            loadKeywords(page, currentSearch, currentCategory);
        }

        // Search keywords
        function searchKeywords() {
            currentSearch = document.getElementById('searchInput').value;
            currentPage = 1;
            loadKeywords(1, currentSearch, currentCategory);
        }

        // Filter keywords
        function filterKeywords() {
            currentCategory = document.getElementById('categoryFilter').value;
            currentPage = 1;
            loadKeywords(1, currentSearch, currentCategory);
        }

        // Show add keyword modal
        function showAddKeywordModal() {
            const modal = new bootstrap.Modal(document.getElementById('addKeywordModal'));
            modal.show();
        }

        // Add single keyword
        async function addSingleKeyword(e) {
            e.preventDefault();
            
            const keywordData = {
                keyword: document.getElementById('singleKeyword').value,
                category: document.getElementById('singleCategory').value,
                difficulty: document.getElementById('singleDifficulty').value,
                searchVolume: parseInt(document.getElementById('singleSearchVolume').value) || 0,
                cpc: parseFloat(document.getElementById('singleCpc').value) || 0,
                intent: document.getElementById('singleIntent').value,
                notes: document.getElementById('singleNotes').value
            };
            
            try {
                const response = await fetch('/api/keywords', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(keywordData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('Keyword added successfully!', 'success');
                    document.getElementById('singleKeywordForm').reset();
                    bootstrap.Modal.getInstance(document.getElementById('addKeywordModal')).hide();
                    loadKeywords(currentPage, currentSearch, currentCategory);
                    loadStats();
                } else {
                    showAlert('Error adding keyword: ' + data.message, 'danger');
                }
            } catch (error) {
                showAlert('Error adding keyword: ' + error.message, 'danger');
            }
        }

        // Add bulk keywords
        async function addBulkKeywords(e) {
            e.preventDefault();
            
            const keywordsText = document.getElementById('bulkKeywords').value;
            const keywordsList = keywordsText.split('\n').filter(k => k.trim()).map(k => k.trim());
            
            if (keywordsList.length === 0) {
                showAlert('Please enter at least one keyword', 'warning');
                return;
            }
            
            const bulkData = {
                keywords: keywordsList,
                category: document.getElementById('bulkCategory').value,
                difficulty: document.getElementById('bulkDifficulty').value,
                intent: document.getElementById('bulkIntent').value
            };
            
            try {
                const response = await fetch('/api/keywords/bulk', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(bulkData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    let message = data.message;
                    if (data.skipped > 0) {
                        message += ` (${data.skipped} duplicates skipped)`;
                    }
                    showAlert(message, 'success');
                    document.getElementById('bulkKeywordForm').reset();
                    bootstrap.Modal.getInstance(document.getElementById('addKeywordModal')).hide();
                    loadKeywords(currentPage, currentSearch, currentCategory);
                    loadStats();
                } else {
                    showAlert('Error adding keywords: ' + data.message, 'danger');
                }
            } catch (error) {
                showAlert('Error adding keywords: ' + error.message, 'danger');
            }
        }

        // Edit keyword
        function editKeyword(keywordId) {
            const keyword = keywords.find(k => k.id === keywordId);
            if (!keyword) return;
            
            document.getElementById('editKeywordId').value = keyword.id;
            document.getElementById('editKeyword').value = keyword.keyword;
            document.getElementById('editCategory').value = keyword.category;
            document.getElementById('editDifficulty').value = keyword.difficulty;
            document.getElementById('editSearchVolume').value = keyword.searchVolume || '';
            document.getElementById('editCpc').value = keyword.cpc || '';
            document.getElementById('editIntent').value = keyword.intent;
            document.getElementById('editNotes').value = keyword.notes || '';
            
            const modal = new bootstrap.Modal(document.getElementById('editKeywordModal'));
            modal.show();
        }

        // Update keyword
        async function updateKeyword() {
            const keywordId = document.getElementById('editKeywordId').value;
            
            const keywordData = {
                keyword: document.getElementById('editKeyword').value,
                category: document.getElementById('editCategory').value,
                difficulty: document.getElementById('editDifficulty').value,
                searchVolume: parseInt(document.getElementById('editSearchVolume').value) || 0,
                cpc: parseFloat(document.getElementById('editCpc').value) || 0,
                intent: document.getElementById('editIntent').value,
                notes: document.getElementById('editNotes').value
            };
            
            try {
                const response = await fetch(`/api/keywords/${keywordId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(keywordData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('Keyword updated successfully!', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('editKeywordModal')).hide();
                    loadKeywords(currentPage, currentSearch, currentCategory);
                    loadStats();
                } else {
                    showAlert('Error updating keyword: ' + data.message, 'danger');
                }
            } catch (error) {
                showAlert('Error updating keyword: ' + error.message, 'danger');
            }
        }

        // Toggle keyword active status
        async function toggleKeyword(keywordId) {
            try {
                const response = await fetch(`/api/keywords/${keywordId}/toggle`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert(data.message, 'success');
                    loadKeywords(currentPage, currentSearch, currentCategory);
                    loadStats();
                } else {
                    showAlert('Error toggling keyword: ' + data.message, 'danger');
                }
            } catch (error) {
                showAlert('Error toggling keyword: ' + error.message, 'danger');
            }
        }

        // Delete keyword
        async function deleteKeyword(keywordId) {
            if (!confirm('Are you sure you want to delete this keyword?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/keywords/${keywordId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('Keyword deleted successfully!', 'success');
                    loadKeywords(currentPage, currentSearch, currentCategory);
                    loadStats();
                } else {
                    showAlert('Error deleting keyword: ' + data.message, 'danger');
                }
            } catch (error) {
                showAlert('Error deleting keyword: ' + error.message, 'danger');
            }
        }

        // Show loading spinner
        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            const keywordsList = document.getElementById('keywordsList');
            
            if (show) {
                spinner.style.display = 'block';
                keywordsList.style.opacity = '0.5';
            } else {
                spinner.style.display = 'none';
                keywordsList.style.opacity = '1';
            }
        }

        // Show alert message
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            const alertId = 'alert-' + Date.now();
            
            const alertHtml = `
                <div id="${alertId}" class="alert alert-${type} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            alertContainer.insertAdjacentHTML('beforeend', alertHtml);
            
            // Auto-dismiss after 5 seconds
            setTimeout(() => {
                const alert = document.getElementById(alertId);
                if (alert) {
                    bootstrap.Alert.getOrCreateInstance(alert).close();
                }
            }, 5000);
        }
    </script>
</body>
</html>